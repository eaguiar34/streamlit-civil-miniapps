import streamlit as st
from pathlib import Path
import fieldflow_core as core

st.set_page_config(page_title="Settings & Examples", page_icon="ðŸ§°", layout="wide")
core.render_sidebar("Settings & Examples")

st.title("Settings & Examples")

st.markdown("### Sample files (download)")
base = Path(__file__).resolve().parents[1] / "sample_data"

samples = [
    ("spec_sample.txt", "Spec sample (text)"),
    ("submittal_sample.txt", "Submittal sample (text)"),
    ("schedule_sample.csv", "Schedule sample (CSV)"),
]

for fn, label in samples:
    fp = base / fn
    if fp.exists():
        st.download_button(
            label=f"Download: {label}",
            data=fp.read_bytes(),
            file_name=fn,
            mime="application/octet-stream",
            use_container_width=True,
        )
    else:
        st.warning(f"Missing file: {fp}")

st.markdown("---")
st.markdown("### One-time setup for Microsoft (avoids Graph workbook creation spam)")
st.markdown(
    "If you're using **Microsoft 365 Excel (OAuth)**, click **Initialize OneDrive workbook** in the sidebar once. "
    "This creates the workbook a single time and saves its ID to session storage so reruns don't keep trying to create it."
)

st.markdown("### Troubleshooting")
st.markdown(
    "- If pages show `AttributeError: module 'fieldflow_core' has no attribute ...`, your deployed `fieldflow_core.py` is not the updated one.\n"
    "- Make sure your GitHub repo contains **fieldflow_core.py** at the repo root, and the `pages/` folder contains **05_Settings_and_Examples.py**.\n"
    "- In Streamlit Cloud, **Manage app â†’ Reboot app** after pushing the latest commit."
)
import streamlit as st
from pathlib import Path
import fieldflow_core as core

st.set_page_config(page_title="Settings & Examples", page_icon="ðŸ§°", layout="wide")
core.render_sidebar("Settings & Examples")

st.title("Settings & Examples")

st.markdown("### Sample files (download)")
base = Path(__file__).resolve().parents[1] / "sample_data"

samples = [
    ("spec_sample.txt", "Spec sample (text)"),
    ("submittal_sample.txt", "Submittal sample (text)"),
    ("schedule_sample.csv", "Schedule sample (CSV)"),
]

for fn, label in samples:
    fp = base / fn
    if fp.exists():
        st.download_button(
            label=f"Download: {label}",
            data=fp.read_bytes(),
            file_name=fn,
            mime="application/octet-stream",
            use_container_width=True,
        )
    else:
        st.warning(f"Missing file: {fp}")

st.markdown("---")
st.markdown("### One-time setup for Microsoft (avoids Graph workbook creation spam)")
st.markdown(
    "If you're using **Microsoft 365 Excel (OAuth)**, click **Initialize OneDrive workbook** in the sidebar once. "
    "This creates the workbook a single time and saves its ID to session storage so reruns don't keep trying to create it."
)

st.markdown("### Troubleshooting")
st.markdown(
    "- If pages show `AttributeError: module 'fieldflow_core' has no attribute ...`, your deployed `fieldflow_core.py` is not the updated one.\n"
    "- Make sure your GitHub repo contains **fieldflow_core.py** at the repo root, and the `pages/` folder contains **05_Settings_and_Examples.py**.\n"
    "- In Streamlit Cloud, **Manage app â†’ Reboot app** after pushing the latest commit."
)
